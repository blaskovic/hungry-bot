#!/bin/bash
echo "Na Purkynce"
TODAY=$(LC=C date "+%A")
BEG_PATTERN="<br \/>"
END_PATTERN="<end>"

case "$TODAY" in
Monday)
    BEG_PATTERN="<pre>"
    TODAY_CZ="PONDĚLÍ"
    ;;
Tuesday)
    TODAY_CZ="ÚTERÝ"
    ;;
Wednesday)
    TODAY_CZ="STŘEDA"
    ;;
Thursday)
    TODAY_CZ="ČTVRTEK"
    ;;
Friday)
    END_PATTERN="<\/pre>"
    TODAY_CZ="PÁTEK"
    ;;
*)
    echo "Dnes je $TODAY, neni menu alebo je nieco spatne."
    rm -rf "$tmp"
    exit 0
esac

#PATTERN="/$BEG_PATTERN$TODAY_CZ/,/$END_PATTERN/"
#curl -s http://www.napurkynce.cz/denni-menu/ | sed 's/<br \/><br \/>/<end>\n<br \/>/g' | awk "$PATTERN" | sed 's/^<br \/>//' | sed 's/<br \/>/\n/g' | sed 's/<[^>]*>//g'

curl -s http://www.napurkynce.cz/denni-menu/ | awk -v day=$TODAY_CZ '
BEGIN {
    idx = 0;

    # Template 1
    #begrx = "<div>("day":.+?)</div>";
    #midrx = "<div>(<span>)?([a-z]\\).[^<]+)(</span>)?</div>";
    #endrx = "(<div>&nbsp;|<pre>.*<\/pre>)";
    #begidx = 1;
    #mididx = 2;

    # Template 2
    RS="<br />";
    begrx = "(<pre>)?("day":.+?)";
    midrx = "^([a-z]\\).[^<]+)";
    endrx = "^$"
    begidx = 2;
    mididx = 1;
}
match($0, begrx, m) {
    res[idx++] = m[begidx];
    lf = 1;
}
match($0, midrx, m) {
    res[idx++] = m[mididx];
}
match($0, endrx) {
    if(lf == 1) {
        for(i in res) print res[i];
    }

    delete res;
    lf = 0;
    idx = 0;
}'
